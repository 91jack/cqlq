<!doctype html>
<html class="no-js">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
	<title>车辆调度-重交沥青搅拌站智慧生产管控系统</title>
	<link rel="stylesheet" type="text/css" href="static/layui/css/layui.css"/>
	<link rel="stylesheet" type="text/css" href="static/css/common.css" />
</head>

<body>
	<div class="header clearfix">
		<h2>重交沥青搅拌站智慧生产管控系统</h2>
		<div class="nav">
			<a href="index.html">
				<img src="static/images/icon_home1.png" alt="" />
				<span>首页</span>
			</a>
			<a href="weigh.html">
				<img src="static/images/icon_chengzhong1.png" alt="" />
				<span>称重过磅</span>
			</a>
			<a href="jiankong.html">
				<img src="static/images/icon_jiankong1.png" alt="" />
				<span>生产监控</span>
			</a>
			<a href="carmanage.html" class="active">
				<img src="static/images/icon_car2.png" />
				<span>车辆调度</span>
			</a>
			
			<a href="kucun.html">
				<img src="static/images/icon_kucun1.png" alt="" />
				<span>库存盘点</span>
			</a>
			<a href="javascript:;">
				<img src="static/images/icon_zhiliang1.png" alt="" />
				<span>质量管控</span>
			</a>
			<a href="javascript:;">
				<img src="static/images/icon_shiyan1.png" />
				<span>实验管理</span>
			</a>
			
			<a  id="tongji">
				<img src="static/images/icon_tongji1.png" />
				<span>统计分析</span>
			</a>
			<ul class="subnav">
				<li><a href="producestate.html">生产动态表</a></li>
				<li><a href="producenum.html">生产量分析</a></li>
				<li><a href="hsl.html">核算量分析</a></li>
				<li><a href="xhl.html">消耗量分析</a></li>
				<li><a href="temp.html">温度波动分析</a></li>
				<li><a href="ysb.html">油石比波动分析</a></li>
			</ul>
		</div>
	</div>

	<div class="container">
		<div class="car-list fl">
			<ul id="carList">
				<li class="active">车辆列表</li>
				<li>渝B123</li>
				<li>渝B223</li>
				<li class="active">渝B323</li>
				<li>渝B423</li>
			</ul>
		</div>
		<div class="car-map fr" id="map"></div>
	</div>
		
		
<script src="static/js/jquery-1.11.0.min.js" type="text/javascript" charset="utf-8"></script>
<script src="static/js/common.js"></script>
<script src="static/js/echarts.min.js" type="text/javascript" charset="utf-8"></script>
<script type="text/javascript" src="https://api.map.baidu.com/api?v=2.0&ak=wqB7npvF7DsDGlFG2oYhih93K5iEqsou"></script>
<script src="static/js/api.js" type="text/javascript" charset="utf-8"></script>

<script type="text/javascript">
// 车辆列表
ajaxData(carList,{},function(data){
	console.log(data)
	var carStr = '';
	for(var i=0;i<data.list.length;i++){
		carStr += '<li carnum="'+data.list[i].carNo+'">'+data.list[i].carNo+'</li>';
	}
	
	$('#carList').html(carStr);
	//var carTrail='http://192.168.1.123:8080/jbz/api/location/history/ajaxGet';
	$('#carList li').bind('click',function(){
		var carNum = $(this).attr('carnum');
		console.log(carNum);
		ajaxData(carTrail,{carNo:carNum},function(data){
			console.log(data)
		})
	})
	
	// 起点
	
	
	// 终点
	
	// 
})
	
// 百度地图API功能
var map = new BMap.Map("map");
//map.centerAndZoom(new BMap.Point(106.26663416162559,29.65266647548469), 15);
//
//var myP1 = new BMap.Point(106.26663416162559,29.65266647548469);    //起点
//var myP2 = new BMap.Point(106.26623233866435,29.652518161353896);    //终点

	map.centerAndZoom(new BMap.Point(116.404, 39.915), 15);

	var myP1 = new BMap.Point(116.380967,39.913285);    //起点
	var myP2 = new BMap.Point(116.424374,39.914668);    //终点

var myIcon = new BMap.Icon("http://lbsyun.baidu.com/jsdemo/img/Mario.png", new BMap.Size(32, 70), {    //小车图片
	//offset: new BMap.Size(0, -5),    //相当于CSS精灵
	imageOffset: new BMap.Size(0, 0)    //图片的偏移量。为了是图片底部中心对准坐标点。
  });
var driving2 = new BMap.DrivingRoute(map, {renderOptions:{map: map, autoViewport: true}});    //驾车实例
driving2.search(myP1, myP2);    //显示一条公交线路

window.run = function (){
	var driving = new BMap.DrivingRoute(map);    //驾车实例
	driving.search(myP1, myP2);
	driving.setSearchCompleteCallback(function(){
		var pts = driving.getResults().getPlan(0).getRoute(0).getPath();    //通过驾车实例，获得一系列点的数组
		console.log(pts)
		var paths = pts.length;    //获得有几个点
//		pts = [
//			{lng: 116.380955, lat: 39.913149},
//			{lng: 116.381045, lat: 39.913151},
//			{lng: 116.381373, lat: 39.913157},
//			{lng: 116.381462, lat: 39.913158},
//			{lng: 116.381641, lat: 39.913161},
//			{lng: 116.38183, lat: 39.913165},
//			{lng: 116.381989, lat: 39.913167},
//			{lng: 116.382406, lat: 39.913165},
//			{lng: 116.383112, lat: 39.913197},
//			{lng: 116.384106, lat: 39.913214}
//		]
		
		var carMk = new BMap.Marker(pts[0],{icon:myIcon});
		map.addOverlay(carMk);
		i=0;
		function resetMkPoint(i){
			carMk.setPosition(pts[i]);
			if(i < paths){
				setTimeout(function(){
					i++;
					resetMkPoint(i);
				},100);
			}
		}
		setTimeout(function(){
			resetMkPoint(5);
		},100)

	});
}

setTimeout(function(){
	run();
},1500);
		
		
	
		
	</script>
	</body>

</html>